# GitHub Copilot Instructions - Spring Boot 3.5 & Java 21

## Project Context
This project uses **Spring Boot 3.5** and **Java 21** for production-level enterprise applications.
Focus: **Maintainability**, **Memory Efficiency**, and **Performance**.

## Best Practices References
Follow these topic-specific guidelines for code generation:

### Core Java & OOP
- [OOP Principles](./copilot-rules/oop-principles.md) - SOLID, encapsulation, sealed classes
- [Collections](./copilot-rules/collections.md) - List, Set, Map usage and optimization
- [Streams & Lambdas](./copilot-rules/streams-lambdas.md) - Functional programming patterns
- [Error Handling](./copilot-rules/error-handling.md) - Exception strategies
- [Concurrency](./copilot-rules/concurrency.md) - Thread safety, virtual threads, async patterns
- [Memory Management](./copilot-rules/memory-management.md) - Resource cleanup and optimization

### Spring Boot Specifics
- [Dependency Injection](./copilot-rules/dependency-injection.md) - Bean management and scopes
- [REST API Design](./copilot-rules/rest-api-design.md) - Controllers and endpoints
- [Data Access](./copilot-rules/data-access.md) - JPA, repositories, transactions
- [Configuration](./copilot-rules/configuration.md) - Properties, profiles, and externalized config
- [Security](./copilot-rules/security.md) - Authentication and authorization
- [Testing](./copilot-rules/testing.md) - Unit and integration tests
- [Observability](./copilot-rules/observability.md) - Logging, metrics, tracing

## General Guidelines

### Code Style
- Use Java 21 features: records, pattern matching, virtual threads, sequenced collections
- Prefer immutability: use `final` for variables and fields when possible
- Use meaningful names: avoid abbreviations, be descriptive
- Keep methods small: single responsibility, <20 lines preferred
- Use sealed classes/interfaces for controlled hierarchies
- Prefer `var` for local variables when type is obvious

### Java 21 Features to Use
```java
// Records for DTOs (immutable, concise)
public record UserDto(String username, String email) {}

// Sealed interfaces for type safety
public sealed interface PaymentMethod permits CreditCard, PayPal, BankTransfer {}

// Pattern matching with switch
String result = switch (shape) {
    case Circle c -> "Circle with radius " + c.radius();
    case Rectangle r when r.width() == r.height() -> "Square";
    case Rectangle r -> "Rectangle " + r.width() + "x" + r.height();
};

// Virtual threads for I/O-bound operations
try (var executor = Executors.newVirtualThreadPerTaskExecutor()) {
    executor.submit(() -> processTask());
}

// Sequenced collections
list.getFirst();
list.getLast();
list.reversed();
```

### Documentation
- Add JavaDoc for public APIs
- Include examples in JavaDoc for complex methods
- Document non-obvious business logic
- Use `@since` tags for API versioning

### Memory Efficiency
- Pre-size collections when size is known: `new ArrayList<>(expectedSize)`
- Use `List.of()`, `Set.of()`, `Map.of()` for immutable collections
- Prefer primitive streams: `mapToInt()`, `mapToLong()`, `mapToDouble()`
- Use `StringBuilder` in loops, not string concatenation
- Close resources with try-with-resources
- Reuse DateTimeFormatter and Pattern instances (static final)

### Performance
- Avoid premature optimization
- Profile before optimizing
- Use appropriate data structures
- Minimize object creation in hot paths
- Leverage virtual threads for I/O-bound operations

### Security
- Never log sensitive data (passwords, tokens, PII)
- Validate all inputs
- Use parameterized queries (never concatenate SQL)
- Follow OWASP guidelines
- Use HTTPS in production

## Quick Reference

### Annotations to Prefer
- `@RestController` over `@Controller` + `@ResponseBody`
- `@RequiredArgsConstructor` (Lombok) for constructor injection
- `@Slf4j` (Lombok) for logging
- `@Transactional(readOnly = true)` for read operations
- `@Valid` for request validation
- `@ConfigurationProperties` for type-safe configuration

### Annotations to Avoid
- `@Autowired` on fields (use constructor injection)
- `@RequestMapping` without specific HTTP method
- `@Component` when more specific stereotype exists

### Common Patterns
```java
// Record for DTOs with validation
public record CreateUserRequest(
    @NotBlank String username,
    @Email String email,
    @Size(min = 8) String password
) {}

// Constructor injection with Lombok
@Service
@RequiredArgsConstructor
public class UserService {
    private final UserRepository repository;
    private final PasswordEncoder encoder;
}

// Virtual threads for parallel I/O
try (var executor = Executors.newVirtualThreadPerTaskExecutor()) {
    List<Future<Result>> futures = tasks.stream()
        .map(task -> executor.submit(() -> process(task)))
        .toList();
    return futures.stream().map(Future::join).toList();
}

// Memory-efficient stream processing
return users.stream()
    .filter(User::isActive)
    .mapToInt(User::getScore)  // primitive stream
    .sum();
```

## Enforcement
When generating code:
1. Always check relevant topic-specific guidelines
2. Apply DO patterns, avoid DON'T patterns
3. Include necessary imports
4. Add appropriate exception handling
5. Consider memory and performance implications
6. Use Java 21 features where appropriate
